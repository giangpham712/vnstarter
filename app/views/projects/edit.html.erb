<h2>Edit project</h2>

<%= form_for :project, url: project_path(@project), method: :put do |f| %>

    <div class="field">
      <%= f.label :title %><br/>
      <%= f.text_field :title, autofocus: true %>
    </div>

    <div class="field">
      <%= f.label :image %><br/>
      <%= f.file_field :image, autofocus: true %>
    </div>

    <div class="field">
      <%= f.label :location %><br/>
      <%= f.text_field :location %>
    </div>

    <div class="field">
      <%= f.label :short_description %><br/>
      <%= f.text_area :short_description %>
    </div>

    <div class="field">
      <%= f.label :funding_goal %><br/>
      <%= f.text_field :funding_goal %>
    </div>

    <div class="actions">
      <%= f.submit "Submit" %>
    </div>
<% end %>

<script>
    $("#project_image").change(function (e) {
        uploadProjectImage();
    });

    function uploadProjectImage() {

        var file = document.getElementById("project_image");

        var formData = new FormData();
        formData.append("upload", file.files[0]);

        var authenticity_token = $("input[name=authenticity_token]").val();

        var uploadRequest = $.ajax({
            url: "/projects/superman-returns/upload_image" + "?authenticity_token=" + authenticity_token,
            type: "POST",
            xhr: function () {
                var myXhr = $.ajaxSettings.xhr();
                if (myXhr.upload) {
                    myXhr.upload.addEventListener('progress', progressHandlingFunction, false);
                }
                return myXhr;
            },
            data: formData,
            cache: false,
            contentType: false,
            processData: false
        });

        uploadRequest.success(function (result) {
            console.log(result);
        });
    }

    function progressHandlingFunction(e) {
        if (e.lengthComputable) {
            console.log(e);
        }
    }
</script>